{% for post in site.posts %}
  {% capture year %}{{ post.date | date: '%Y' }}{% endcapture %}
  {% capture month %}{{ post.date | date: '%M' }}{% endcapture %}
  {% capture nyear %}{{ post.next.date | date: '%Y' }}{% endcapture %}
  {% if year != nyear %}
    <h3>{{ post.date | date: '%Y' }}</h3>
  {% endif %}

    {% capture month %}{{ post.date | date: '%Y-%m' }}{% endcapture %}
    {% capture nmonth %}{{ post.next.date | date: '%Y-%m' }}{% endcapture %}
        {% if month != nmonth %}
          {% if forloop.index != 1 %}
            </ul>
          {% endif %}
          {% capture posts %}
            {% capture post_month %}{{ post.date | date: '%Y-%m' }}{% endcapture %}
            {% for check_post in site.posts %}
              {% capture check_month %}{{ check_post.date | date: '%Y-%m' }}{% endcapture %}
              {% if check_month == post_month %}
                {{ check_month }}
              {% endif %}
            {% endfor %}
          {% endcapture %}
          {% assign sortedtags = posts | split:' ' | sort %}


          <h3>{{ post.date | date: '%Y-%m' }}  ({{ sortedtags.size }})</h3>
          <ul>
        {% endif %}
    <li><a href="{{ post.url }}">{{ post.title }} {{ post.date | date: "%Y-%m-%d" }}</a></li>
    <!-- <time>{{ post.date | date: "%Y-%m-%d" }}</time> -->
{% endfor %}